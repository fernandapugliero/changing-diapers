<!DOCTYPE html>
<html lang="en">
<head>  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Changing Tables in Berlin ‚Äì Fix My Diaper | Baby-friendly caf√©s, restaurants & parks</title>

  <!-- Primary SEO -->
  <meta name="description" content="Find baby-friendly places with changing tables in Berlin. Caf√©s, restaurants, churches and public toilets with diaper-changing stations‚Äîmapped and reviewed." />
  <meta name="robots" content="index, follow" />

  <!-- Open Graph -->
  <meta property="og:title" content="Fix My Diaper: Find Baby-Friendly Places with Changing Tables" />
  <meta property="og:description" content="Find the best baby-friendly places with changing tables near you. Submit locations and help other parents." />
  <meta property="og:image" content="https://fixmydiaper.com/images/logo.png" />
  <meta property="og:url" content="https://fixmydiaper.com" />
  <meta property="og:type" content="website" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Fix My Diaper: Find Baby-Friendly Places with Changing Tables" />
  <meta name="twitter:description" content="Find baby-friendly places with changing tables near you ‚Äì caf√©s, restaurants, and more." />
  <meta name="twitter:image" content="https://fixmydiaper.com/images/logo.png" />

  <!-- JSON-LD (Organization + WebSite) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"Fix My Diaper",
    "url":"https://fixmydiaper.com",
    "logo":"https://fixmydiaper.com/images/logo.png",
    "sameAs":["https://www.instagram.com/fixmydiaper"]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://fixmydiaper.com",
    "name":"Fix My Diaper",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://fixmydiaper.com/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JGYVLDZQTM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-JGYVLDZQTM');
  </script>

  <link rel="icon" href="/images/favicon.ico" sizes="any">
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Seu CSS atual (mantido) -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Complementos leves para SEO list / micro ajustes sem mexer no seu style.css */
    .seo-note-de {
      font-size: 0.9rem;
      color: #666;
      text-align: center;
      margin: 10px auto 24px;
      max-width: 920px;
      line-height: 1.45;
    }
    .featured {
      max-width: 960px;
      margin: 28px auto 0;
      padding: 0 12px;
    }
    .featured h2 {
      text-align: center;
      font-size: 1.3rem;
      margin: 0 0 12px 0;
      font-weight: 800;
      line-height: 1.25;
    }
    .featured p.desc {
      text-align: center;
      color: #555;
      margin: 0 0 12px 0;
      font-size: 0.95rem;
    }
    .featured ul {
      list-style: none;
      padding: 0;
      margin: 16px auto 0;
      max-width: 780px;
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 10px;
    }
    @media (min-width: 680px){
      .featured ul { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .featured li {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px 14px;
      background: #fff;
    }
    .featured li strong { font-weight: 600; }
    .featured .meta {
      color: #666; font-size: 0.92rem; margin-top: 4px;
    }
    /* Noscript para mapa */
    noscript.noscript-map {
      display:block;
      max-width: 920px;
      margin: 8px auto 0;
      font-size: 0.95rem;
      color: #666;
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- NAV -->
  <nav>
    <img src="images/logo.png" alt="Fix My Diaper Logo" width="30" height="30" />
    <a href="/">Map</a>
    <a href="list">List</a>
    <a href="submit">Submit</a>
  </nav>

  <!-- Hero -->
  <h1>Need to change a diaper?</h1>
  <h2>Find baby-friendly places with changing tables near you ‚Äì caf√©s, restaurants, churches and parks.</h2>

  <!-- üîé Geo-search (mant√©m seus IDs e classes) -->
  <div id="geo-search" class="map-search">
    <input id="geo-input" class="ui-input" type="text" placeholder="Type an address, ZIP code, or city and country" />
    <button id="geo-go" class="ui-btn ui-btn--primary" type="button">Go</button>
    <button id="geo-me" class="ui-btn ui-btn--ghost" type="button">Use my location</button>
  </div>

  <!-- MAP -->
  <div id="map" aria-label="Map of baby-friendly places with changing tables"></div>
  <noscript class="noscript-map">
    Map requires JavaScript. Meanwhile, see a curated list of changing tables in Berlin below.
  </noscript>

  <!-- üá©üá™ Sinal em alem√£o para ranquear ‚Äúwickeltisch berlin‚Äù -->
  <p class="seo-note-de">
    Auch bekannt als <strong>Wickeltisch-Finder in Berlin</strong> ‚Äì entdecken Sie kinderfreundliche Caf√©s, Restaurants und Parks
    mit <strong>Wickeltischen</strong>. Eltern k√∂nnen neue Orte einreichen und anderen Familien helfen, unterwegs bequem zu <em>wickeln</em>.
  </p>

  <!-- ‚úÖ Bloco index√°vel (populado via places.json) -->
  <section class="featured" id="featured-places">
    <h2>Best changing tables in Berlin</h2>
    <p class="desc">A quick, indexable list (auto-generated from our community map) to help parents find great spots fast.</p>
    <ul id="featured-list">
      <!-- JS vai preencher com at√© 8 locais de Berlin, ordenados pela nota -->
    </ul>
  </section>

  <!-- Texto convite + link submit -->
  <h2 style="text-align:center; font-size:1.2rem; margin-top: 28px;">Know a great spot?</h2>
  <p>Help us make the list even better!
     <a href="submit.html">Submit a location</a> where you found a great diaper changing station.</p>

  <!-- (Opcional) Airtable embed ‚Äì mant√©m, mas n√£o √© necess√°rio para SEO -->
  <iframe
     class="airtable-embed"
     src="https://airtable.com/embed/appjWF7WnC8DRWaXM/shr42I0LCf48OO9G1?layout=card&viewControls=on"
     frameborder="0"
     width="100%"
     height="600"
     loading="lazy"
     style="background: transparent; border: 1px solid #ccc; border-radius: 8px;">
  </iframe>

  <!-- Newsletter banner (mantido) -->
  <section class="nl-banner" aria-label="Newsletter sign-up">
    <div class="nl-wrap">
      <h2 class="nl-title">üíå Join our newsletter</h2>
      <p class="nl-sub">Parenting tips, baby-friendly places and project updates ‚Äì in your inbox.</p>
      <form class="nl-form" action="https://fixmydiaper.substack.com/api/v1/free" method="post" target="_blank" onsubmit="return true;">
        <input class="ui-input" type="email" name="email" placeholder="Your email address" required />
        <button class="ui-btn ui-btn--primary" type="submit">Subscribe</button>
      </form>
    </div>
  </section>
  <div class="footer-spacer"></div>

  <!-- Footer -->
  <footer>
    <a href="about">About</a> | 
    <a href="submit">Submit a Location</a> |
    <a href="https://www.instagram.com/fixmydiaper">Instagram</a><br/><br/>
    Made with ‚ô•Ô∏è in Berlin<br />
    Created by <a href="https://fernandapugliero.com" target="_blank" rel="noopener">Fernanda Pugliero</a>
  </footer>

  <!-- Scripts -->
  <script defer src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script defer src="script.js"></script>

  <!-- Mini-script: popula a lista SEO a partir de places.json -->
  <script>
  // Regras: mostra at√© 8 locais de Berlin, com melhor "overall_user_experience" primeiro
  (function(){
    const listEl = document.getElementById('featured-list');
    if (!listEl) return;

    fetch('places.json', { cache: 'no-cache' })
      .then(r => r.json())
      .then(items => {
        if (!Array.isArray(items)) return;

        // filtra Berlin (sem case) + tem coordenadas
        const berlin = items.filter(p => {
          const city = (p.city || '').toString().toLowerCase();
          return city.includes('berlin') && p.latitude && p.longitude;
        });

        // ordena por nota (0‚Äì10), decrescente; se faltar nota, joga pro fim
        berlin.sort((a, b) => {
          const sa = typeof a.overall_user_experience === 'number' ? a.overall_user_experience : -1;
          const sb = typeof b.overall_user_experience === 'number' ? b.overall_user_experience : -1;
          return sb - sa;
        });

        const top = berlin.slice(0, 8);
        if (!top.length) {
          listEl.innerHTML = '<li>Berlin places will appear here as soon as the map loads.</li>';
          return;
        }

        listEl.innerHTML = top.map(p => {
          const name = p.name || 'Unnamed place';
          const type = p.type || 'Place';
          const addr = p.address ? ` ‚Äî ${p.address}` : '';
          let stars = '';
          if (typeof p.overall_user_experience === 'number') {
            const s = Math.round(Math.max(0, Math.min(10, p.overall_user_experience)) / 2 * 2) / 2; // 0‚Äì5, meio ponto
            stars = `<span class="star-rating" aria-hidden="true" style="--rating:${s}"></span>`;
          }
          return `
            <li>
              <strong>${name}</strong>
              <div class="meta">${type}${addr}</div>
              ${stars ? `<div style="margin-top:6px">${stars}</div>` : ''}
            </li>`;
        }).join('');
      })
      .catch(() => {
        listEl.innerHTML = '<li>Could not load featured list right now.</li>';
      });
  })();
  </script>
</body>
</html>
